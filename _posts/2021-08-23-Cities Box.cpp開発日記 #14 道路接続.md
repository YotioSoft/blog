---
layout: post
title: Cities Box.cpp開発日記 #14 道路接続
tags: [Cities Box.cpp,C++,OpenSiv3D,開発日記]
excerpt_separator: <!--more-->
---

3ヶ月半ぶりとなってしまいましたが、Cities Box.cppの開発日記を再開したいと思います。  
前回は昔過ぎてうろ覚えですが、UbuntuでCities Boxが動いたよ！というご報告だったと思います。  
今回は第14回、道路の接続についての話題です。

<!--more-->

# 道路の接続とは

実は今までは、マップ上に道路を引いたとき、道路同士が繋がっている「ふり」をして描画させていました。  



これら1マス1マスの各タイル上の道路は、描画上はさも接続されているかのように見せかけていますが、システム的には実は独立しており、ゲームプログラム側はどの道路とどの道路が接続されているのか把握していない状態でした。  
これを接続させようというのが今回の開発日記の主な話題です。



# 道路の接続によるメリット

## 経路探索が可能になる

これが最大の利点と言えます。  
道路の接続状態を有向グラフ化してしまえば、ある地点から目的地までの経路探索が可能になります。  
つまり、カーナビと同じことがゲーム上でシミュレートできるわけです。  



## コード量の軽減

これまでは、道路を敷設するたびに1マスごとに周囲に道路が存在するか確認する、という処理が必要でした。  
マスの周囲に道路が存在するか、同じ種類の道路か、接続可能か…などの判定のためのプログラムが必要です。  
今回は敷設と同時に道路接続状態を構造体に格納しておくことで、接続可能な道路の有無を簡単に把握できるようにしました。



## 電線や水道管といったインフラ系にも転用可能

まだCities Boxには実装していませんが、将来実装するであろう電線や水道管も同じ手法でグラフ化できます。  
プログラムを使い回せば開発コストを軽減できます。



## その他諸々

いまのところ思いつくのはこれくらいですが、マップの管理をかなり効率化できるはずです。



# 経路探索アルゴリズム

経路探索のアルゴリズムには複数あります。有名なのはダイクストラ法です。  
ほかにも、hub labelingやpruned highway labelingといった手法があるようです。  
今回は（自分がダイクストラ法しか知らないという理由により）とりあえず**ダイクストラ法で実装**します。  
経路探索を関数化しておけば、中身のアルゴリズム自体は後で取り替えられますからね。



